---
title: "Población en España "
author: "Lijun Lin"
github: {user: LINLJN, repo: Proyecto-Final, branch: "master"}
date: "20/11/2019"
output: 
  rmarkdown::html_document:
    theme: flatly

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r p, echo=FALSE}
#install.packages("gifski")
autonoma <-  read.csv('dat/Poblacion/2853sc.csv',sep = ";",skip = 5)

  mil <- function(x){
    x<-as.numeric(gsub("\\.","",x))
  }
  
autonoma[,2:70] <- lapply(autonoma[,2:70],mil)

p.total <- autonoma[,c(1:24)]
p.total <- p.total[-c(1,20:24),]
library(reshape2)
p.total <- melt(p.total,"X")
p.total$variable <- gsub('X','',p.total$variable)

```

```{r p.total, echo=FALSE}
library(tidyverse)
library(gganimate)
library(gapminder)
theme_set(theme_classic())

gap <- p.total %>%
  group_by(X) %>%
  # The * 1 makes it possible to have non-integer ranks while sliding
  mutate(rank = min_rank(-value)) %>%
  ungroup()

a <- ggplot(gap, aes(rank, group = X, 
                     fill = as.factor(X), color = as.factor(X))) +
  geom_tile(aes(y = value,
                height = value,
                width = 0.9), alpha = 0.8, color = NA) +
  
  # text in x-axis (requires clip = "off" in coord_*)
  # paste(country, " ")  is a hack to make pretty spacing, since hjust > 1 
  #   leads to weird artifacts in text spacing.
  geom_text(aes(y = 0, label = paste(X, " ")), vjust = 0.2, hjust = 1) +
  
  coord_flip(clip = "off", expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +
  
  labs(title='aa', x = "", y = "yy") +
  theme(plot.title = element_text(hjust = 0, size = 22),
        axis.ticks.y = element_blank(),  # These relate to the axes post-flip
        axis.text.y  = element_blank(),  # These relate to the axes post-flip
        plot.margin = margin(1,1,1,4, "cm")) +
  
  transition_states(year, transition_length = 4, state_length = 1) +
  ease_aes('cubic-in-out')

animate(a, fps = 25, duration = 20, width = 800, height = 600)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
